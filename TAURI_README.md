# Building the Mondelez Intune Widget with Tauri v2

This guide explains how to turn the React code provided into a native executable (EXE, APK, IPA) using Tauri v2 for deployment via Intune.

## Prerequisites

1.  **Node.js (20+)**: Installed.
2.  **Rust**: Install via `rustup` (https://rustup.rs/).
3.  **Visual Studio C++ Build Tools** (Windows): Required for compiling Rust on Windows.
4.  **Android Studio**: Required for APK generation (with NDK and SDK Platform Tools installed).
5.  **Xcode** (macOS only): Required for IPA generation.

## Step 1: Initialize Tauri Project

In your terminal, in the root of this project:

```bash
npm install @tauri-apps/cli @tauri-apps/api
npx tauri init
```

Select the following options:
- Package Manager: `npm`
- Frontend Language: `TypeScript / React`

## Step 2: Configuration (`tauri.conf.json`)

Modify `src-tauri/tauri.conf.json` to match the Mondelez requirements:

```json
{
  "productName": "mdlz-self-service",
  "version": "1.0.0",
  "identifier": "com.mondelez.intune.widget",
  "build": {
    "beforeDevCommand": "npm run start",
    "beforeBuildCommand": "npm run build",
    "devUrl": "http://localhost:3000",
    "frontendDist": "../build"
  },
  "bundle": {
    "active": true,
    "targets": "all",
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ]
  }
}
```

## Step 3: Authentication (Entra ID / MSAL) in Tauri

In a standard web app, MSAL redirects to a URL. In Tauri (Desktop/Mobile), the `localhost` redirect often fails or isn't secure.

1.  **App Registration**: Register a "Mobile and desktop applications" platform in Entra ID.
2.  **Redirect URI**: Use `msauth://com.mondelez.intune.widget` (for mobile) and `http://localhost` (for desktop, using LoopbackClient).
3.  **Code Change**: In `App.tsx`, you will need to swap the mock login for `@azure/msal-browser`. For Tauri, you typically use the `plugin-deep-link` to handle the callback or start a local server.

## Step 4: Building the Binaries

### Windows (.exe / .msi)
Run this command on a Windows machine:
```bash
npx tauri build
```
*Output location:* `src-tauri/target/release/bundle/msi/` or `nsis/`.

### Android (.apk)
1.  Initialize Android target:
    ```bash
    npx tauri android init
    ```
2.  Build APK:
    ```bash
    npx tauri android build
    ```
*Output location:* `src-tauri/gen/android/app/build/outputs/apk/release/`

### iOS (.ipa)
*Note: Must be run on macOS.*
1.  Initialize iOS target:
    ```bash
    npx tauri ios init
    ```
2.  Build IPA:
    ```bash
    npx tauri ios build
    ```
*Note:* You will need a valid Apple Developer Account and Provisioning Profile to sign the IPA for distribution.

## Step 5: Intune Deployment

1.  **Windows (.intunewin)**:
    - Use the **Microsoft Win32 Content Prep Tool**.
    - Source folder: Folder containing the `.exe` generated by Tauri.
    - Setup file: `mdlz-self-service.exe`.
    - Upload the resulting `.intunewin` file to Intune as a Win32 App.
    - Install command: `mdlz-self-service.exe /S` (if using NSIS installer).

2.  **Android (Managed Google Play)**:
    - Upload the `.aab` (Android App Bundle) or APK to the Managed Google Play console (linked to your Intune tenant).
    - Sync Intune and assign to users.

3.  **iOS**:
    - Add as a Line-of-Business (LOB) app in Intune using the `.ipa` file.

## Security Note

Remember to inject your Gemini `API_KEY` securely. For Tauri, you can use `tauri-plugin-store` or embedded environment variables during the build process, but avoid committing keys to Git.
